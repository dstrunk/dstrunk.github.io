{"data":{"markdownRemark":{"html":"<p>I haven’t blogged in a while, and there’s a reason for that: I’m working on combining my portfolio and blog into one site over at <a href=\"http://danielstrunk.me\">danielstrunk.me</a>. Recently, however, I was working on a WordPress layout, and built out something that could help others in my situation… and I couldn’t wait to publish it on the new platform!</p>\n<p>When building themes, I like to use <a href=\"http://www.advancedcustomfields.com/\">Advanced Custom Fields</a>. It is a fantastic plugin that allows for custom meta fields to be quickly defined while easily retaining that WordPress look. It’s quite a powerful plugin that I like to use in conjunction with custom post types such as portfolios, as they usually have a lot of bespoke needs.</p>\n<p><strong>Advanced Custom Fields Pro</strong>, ACF’s newest update, has some great features like <a href=\"http://www.advancedcustomfields.com/resources/flexible-content/#template-usage\">flexible content</a>. I’m able to build a theme that feels like a powerful CMS while still retaining relatively tight control over the layout. First, check out the flexible content’s <a href=\"http://www.advancedcustomfields.com/resources/flexible-content/#template-usage\">awesome documentation</a> to understand the below code.</p>\n<p>With ACF’s flexible content, I defined a series of layouts for a portfolio. The portfolio would allow for text, single images, image galleries, callout text, and quotes. With these six content areas defined, I created my first pass at a portfolio layout:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">have_rows</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'section'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token function\">have_rows</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'section'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token function\">the_row</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span>\n  <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">get_row_layout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token single-quoted-string string\">'text'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token delimiter important\">?></span></span>\n      <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">get_template_part</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'templates/portfolio/text'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span>\n    <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token function\">get_row_layout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token single-quoted-string string\">'single_image'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token delimiter important\">?></span></span>\n      <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">get_template_part</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'templates/portfolio/single-image'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span>\n    <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token function\">get_row_layout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token single-quoted-string string\">'image_gallery'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token delimiter important\">?></span></span>\n      <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">get_template_part</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'templates/portfolio/image-gallery'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span>\n    <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token function\">get_row_layout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token single-quoted-string string\">'callout_text'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token delimiter important\">?></span></span>\n      <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">get_template_part</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'templates/portfolio/callout-text'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span>\n    <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">elseif</span> <span class=\"token punctuation\">(</span><span class=\"token function\">get_row_layout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token single-quoted-string string\">'quote'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token delimiter important\">?></span></span>\n      <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">get_template_part</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'templates/portfolio/quote'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span>\n    <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">endif</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span>\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">endwhile</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">endif</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span></code></pre></div>\n<p>Look at all that duplication! There has to be a better way. There’s repetition galore, and if I add another flexible content section on the backend, I’d have to add yet another conditional to my layout in addition to a new template. We developers are a lazy bunch, so I knew there was a better way. And there is: through <a href=\"http://en.wikipedia.org/wiki/Polymorphism_%28computer_science%29\">polymorphism</a>, we can define a generic function and have it Just Work™ with any number of new layouts.</p>\n<p>First, I borrowed heavily from <a href=\"http://apidock.com/rails/ActiveSupport/Inflector/parameterize\">Rails for parameterization</a> (virtually a one-to-one Ruby to PHP translation, in fact):</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token keyword\">function</span> <span class=\"token function\">parameterize</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$string</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$sep</span> <span class=\"token operator\">=</span> <span class=\"token single-quoted-string string\">'-'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token variable\">$parameterized_string</span> <span class=\"token operator\">=</span> <span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span><span class=\"token double-quoted-string string\">\"/[^a-z0-9\\-]+/\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$sep</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$string</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$parameterized_string</span> <span class=\"token operator\">=</span> <span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span><span class=\"token double-quoted-string string\">\"/<span class=\"token interpolation\"><span class=\"token variable\">$sep</span></span>{2,}/\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$sep</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$parameterized_string</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$parameterized_string</span> <span class=\"token operator\">=</span> <span class=\"token function\">preg_replace</span><span class=\"token punctuation\">(</span><span class=\"token double-quoted-string string\">\"/^<span class=\"token interpolation\"><span class=\"token variable\">$sep</span></span>|<span class=\"token interpolation\"><span class=\"token variable\">$sep</span></span>$/\"</span><span class=\"token punctuation\">,</span> <span class=\"token single-quoted-string string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$parameterized_string</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token function\">strtolower</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$parameterized_string</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></span></code></pre></div>\n<p>I place this function in <code class=\"language-text\">functions.php</code>, or wherever you need to define your helpers. This function allows me to take any string and return a dash-separated version of said string, with all spaces and special characters removed (<code class=\"language-text\">aren&#39;t regular expressions fun?!</code> turns into <code class=\"language-text\">arent-regular-expressions-fun</code>).</p>\n<p>From here, I revisited my conditional-heavy layout:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">have_rows</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'section'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token function\">have_rows</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'section'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token function\">the_row</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span>\n  <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token variable\">$layout</span> <span class=\"token operator\">=</span> <span class=\"token function\">parameterize</span><span class=\"token punctuation\">(</span><span class=\"token function\">get_row_layout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span>\n    <span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token function\">get_template_part</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'templates/portfolio/'</span> <span class=\"token punctuation\">.</span> <span class=\"token variable\">$layout</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span>\n<span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span> <span class=\"token keyword\">endwhile</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">endif</span><span class=\"token punctuation\">;</span> <span class=\"token delimiter important\">?></span></span></code></pre></div>\n<p><strong>MUCH</strong> better. The only thing I have to worry about now is making sure the flexible content I’ve defined has the same (parameterized) name as my template partial. This makes it easy to add new flexible content areas, and ensures my template partials are named in a logical manner.</p>\n<p>Hope that helps somebody that finds themselves in a similar situation… Do your part to decrease duplication in the WordPress community! :)</p>","frontmatter":{"title":"Replace conditional with polymorphism in WordPress themes and Advanced Custom Fields","date":null}}},"pageContext":{"slug":"replace-conditional-with-polymorphism-in-wordpress-themes-and-advanced-custom-fields","type":"blog","jekyllDate":"2015-04-29"}}